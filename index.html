<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

  <title>Calculador Gama Academy</title>
</head>

<body>

  <form id="calculadora">

    <h3 id="calculo"></h3>
    <h2 id="resultado"></h2>

    <div class="linha">
      <!-- Função Apagar o Visor -->
      <input onClick="deletar()" type="button" value="CE" title="Limpar a tela">
      <!-- Função Corrigir -->
      <input onClick="corrigir()" type="button" value="C" title="Apagar o último digito">
      <!-- Salvar -->
      <input onClick="salvar()" type="button" value="Save"
        title="Salvar todos os cálculos">
      <!-- Apagar Memória -->
      <input onClick="limparMemoria()" type="button" value="AC" type="button" title="Apagar Memória">
    </div>

    <div class="linha">
      <input onClick="botaoNumerico('7')" type="button" value="7">
      <input onClick="botaoNumerico('8')" type="button" value="8">
      <input onClick="botaoNumerico('9')" type="button" value="9">
      <!-- DIVISÃO -->
      <input onClick="botaoOperador(' / ')" type="button" value="/">
    </div>

    <div class="linha">
      <input onClick="botaoNumerico('4')" type="button" value="4">
      <input onClick="botaoNumerico('5')" type="button" value="5">
      <input onClick="botaoNumerico('6')" type="button" value="6">
      <!-- MULTIPLICAÇÃO -->
      <input onClick="botaoOperador(' * ')" type="button" value="x">
    </div>

    <div class="linha">
      <input onClick="botaoNumerico('1')" type="button" value="1">
      <input onClick="botaoNumerico('2')" type="button" value="2">
      <input onClick="botaoNumerico('3')" type="button" value="3">
      <!-- SUBTRAÇÃO -->
      <input onClick="botaoOperador(' - ')" type="button" value="-">
    </div>

    <div class="linha">
      <input onClick="botaoNumerico('0')" type="button" value="0">
      <!-- Ponto -->
      <input onClick="botaoNumerico('.')" type="button" value=".">
      <!-- IGUALDADE, Função de CALCULAR -->
      <input type="button" value="=" onClick="calcular()">
      <!-- SOMA -->
      <input onClick="botaoOperador(' + ')" type="button" value="+">

    </div>
    
    <p id="dados"></p>>
  </form>

  <!-- <div id="modal">
    <div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <p id="dados"></p>>
        </div>
      </div>
    </div>
  </div> -->
  <script>

    let visorExpressao = document.getElementById("resultado");
    visorExpressao.innerHTML = '0';
    let calculo = document.getElementById('calculo')
    calculo.innerHTML = "crie um cálculo";
    let historico = document.getElementById('historico');
    let modal = document.getElementById('dados')

    var dadosHistorico = [];
    var calculado = false; //resetar expressao
    var input = 0;

    function botaoNumerico(value) {
      if (visorExpressao.innerHTML == "0" && value != ".") {
        visorExpressao.innerHTML = ""
      }
      if (!(value == ".") || !input.match(/[.]/)) {
        input += value
        visorExpressao.innerHTML += value
        console.log(input)
      }
      if (calculado) {
        visorExpressao.innerHTML = value
        calculado = false
      }
    }

    function botaoOperador(operator) {
      if (input !== 0 && input !== " - ") {
        // estilização do sinal de multiplicação
        if (operator === " * ") {
          visorExpressao.innerHTML += " x "
          input = 0;
        }
        if (operator !== " * ") {
          visorExpressao.innerHTML += operator;
          input = 0;
        }
      }
      // Se o primeiro numero é negativo
      if (visorExpressao.innerHTML == "0" && operator == " - ") {
        visorExpressao.innerHTML = operator
        input = 0;
      }
      calculado = false
    }

    function calcular() {
      regex = /[0-9]/

      if (regex.test(visorExpressao.innerHTML.slice(-1))) { //impede calculo de expressão imcompleta
        calculo.innerHTML = visorExpressao.innerHTML + " = "
        var expressao = visorExpressao.innerHTML
        var expressaoCorrigida = expressao.replace(/[x]/g, " * ") //corrigir sinal de multiplicação para eval
        var resultado = eval(expressaoCorrigida)
        var resultadoCorrigido = resultado.toString()
        dadosHistorico.push("\n" + calculo.innerHTML + resultado)
        console.log(dadosHistorico)
        visorExpressao.innerHTML = resultado
        calculado = true

      } else {
        window.alert("Cálculo não pode ser realizado com operação vazia")
        preventDefault();
      }
    }

    function deletar() {
      visorExpressao.innerHTML = "0"
      calculo.innerHTML = "crie um cálculo"
      input = 0
      // dados = []
    }

    function corrigir() {
      regex = /[0-9]/
      // Regex usando pra calibrar a correção.
      if (regex.test(visorExpressao.innerHTML.slice(-1))) {
        input = input.slice(0, -1)
        visorExpressao.innerHTML = visorExpressao.innerHTML.slice(0, -1)
        if (visorExpressao.innerHTML == '') {
          input = 0;
          visorExpressao.innerHTML = 0;
        }
      }

      else {
        input = input.slice(0, -2)
        visorExpressao.innerHTML = visorExpressao.innerHTML.slice(0, -2)
      }
    }

    // FUNÇAO MODAL
    function salvar() {

      modal.innerHTML = ""; //Reseta os dados Historicos no modal

      for (let i = 0; i < dadosHistorico.length; i++) {
        modal.innerHTML += `${dadosHistorico[i]}` + '</br>'
      }
    }

    function limparMemoria() {
      dadosHistorico.length = 0
      modal.innerHTML = ""
    }

    // Acessibilidade
    document.addEventListener("keydown", function (e) {
      switch (e.key) {
        case '1':
          botaoNumerico('1')
          break;
        case '2':
          botaoNumerico('2')
          break;
        case '3':
          botaoNumerico('3')
          break;
        case '4':
          botaoNumerico('4')
          break;
        case '5':
          botaoNumerico('5')
          break;
        case '6':
          botaoNumerico('6')
          break;
        case '7':
          botaoNumerico('7')
          break;
        case '8':
          botaoNumerico('8')
          break;
        case '9':
          botaoNumerico('9')
          break;
        case '0':
          botaoNumerico('0')
          break;
        case '.':
          botaoNumerico('.')
          break;
        case ',':
          botaoNumerico('.')
          break;
        case '/':
          botaoOperador(' / ')
          break;
        case '*':
          botaoOperador(' * ')
          break;
        case '-':
          botaoOperador(' - ')
          break;
        case '+':
          botaoOperador(' + ')
          break;
        case 'Enter':
          calcular()
          break;
        case 'Backspace':
          corrigir()
          break;
        case 'Delete':
          deletar()
          break;
        case 'Insert':
          salvar()
          break;
        case 'End': 
          limparMemoria()
          break;
        default:
          console.log('ERRO');
      }

    });

  </script>
</body>

</html>
<!-- 25663 / 3 - 9 = -->