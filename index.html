<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

  <title>Calculador Gama Academy</title>
</head>

<body>

  <form id="calculadora">

    <h3 id="historico"></h3>
    <h2 id="resultado"></h2>

    <div class="linha">
      <!-- Função Apagar -->
      <input onClick="deletar()" type="button" value="AC">
      <!-- Função Corrigir -->
      <input onClick="corrigir()" type="button" value="C">
      <!-- Salvar -->
      <input onClick="salvar()" type="button" value="Save" type="button" data-toggle="modal" data-target=".bd-example-modal-sm">
    </div>

    <div class="linha">
      <input onClick="botaoNumerico('7')" type="button" value="7">
      <input onClick="botaoNumerico('8')" type="button" value="8">
      <input onClick="botaoNumerico('9')" type="button" value="9">
      <!-- DIVISÃO -->
      <input onClick="botaoOperador(' / ')" type="button" value="/">
    </div>

    <div class="linha">
      <input onClick="botaoNumerico('4')" type="button" value="4">
      <input onClick="botaoNumerico('5')" type="button" value="5">
      <input onClick="botaoNumerico('6')" type="button" value="6">
      <!-- MULTIPLICAÇÃO -->
      <input onClick="botaoOperador(' * ')" type="button" value="x">
    </div>

    <div class="linha">
      <input onClick="botaoNumerico('1')" type="button" value="1">
      <input onClick="botaoNumerico('2')" type="button" value="2">
      <input onClick="botaoNumerico('3')" type="button" value="3">
      <!-- SUBTRAÇÃO -->
      <input onClick="botaoOperador(' - ')" type="button" value="-">
    </div>

    <div class="linha">
      <input onClick="botaoNumerico('0')" type="button" value="0">
      <!-- Ponto -->
      <input onClick="botaoNumerico('.')" type="button" value=".">
      <!-- IGUALDADE, Função de CALCULAR -->
      <input type="button" value="=" onClick="calcular()">
      <!-- SOMA -->
      <input onClick="botaoOperador(' + ')" type="button" value="+">

    </div>
  </form>

  <p id="dadosHistorico"></p>

  <input type="button" data-toggle="modal" data-target=".bd-example-modal-sm">Modal
    pequeno</input>

  <div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <p id="dados"></p>>
      </div>
    </div>
  </div>

  <script>

    let telaResultado = document.getElementById("resultado");
    telaResultado.innerHTML = '0';
    let historico = document.getElementById('historico')
    historico.innerHTML = "crie um cálculo";
    let modal = document.getElementById('dados')

    var dadosHistorico = [];
    var calculado = false; //resetar expressao
    var input = 0;

    function botaoNumerico(value) {
      if (telaResultado.innerHTML == "0" && value != ".") {
        telaResultado.innerHTML = ""
      }
      if (!(value == ".") || !input.match(/[.]/)) {
        input += value
        telaResultado.innerHTML += value
        console.log(input)
      }
      if (calculado) {
        telaResultado.innerHTML = value
        calculado = false
      }
    }

    function botaoOperador(operator) {
      if (input !== 0 && input !== " - ") {
        // estilização do sinal de multiplicação
        if (operator === " * ") {
          telaResultado.innerHTML += " x "
          input = 0;
        }
        if (operator !== " * ") {
          telaResultado.innerHTML += operator;
          input = 0;
        }
      }
      // Se o primeiro numero é negativo
      if(telaResultado.innerHTML == "0" && operator == " - "){
        telaResultado.innerHTML = operator
        input = 0;
      }
      calculado = false
    }

    function calcular() {
      regex = /[0-9]/

      if (regex.test(telaResultado.innerHTML.slice(-1))) {
        historico.innerHTML = telaResultado.innerHTML + " = "
        var expressao = telaResultado.innerHTML
        var expressaoCorrigida = expressao.replace(/[x]/g, " * ") //corrigir sinal de multiplicação para eval
        var resultado = eval(expressaoCorrigida)
        dadosHistorico.push("\n" + historico.innerHTML + resultado)
        console.log(dadosHistorico)
        telaResultado.innerHTML = resultado

        calculado = true

      } else {
        window.alert("Cálculo não pode ser realizado com operação vazia")
        preventDefault();
      }
    }

    function deletar() {
      telaResultado.innerHTML = "0"
      historico.innerHTML = ""
      input = 0
      // dados = []
    }

    function corrigir() {
      regex = /[0-9]/
      // Regex usando pra calibrar a correção.
      if (regex.test(telaResultado.innerHTML.slice(-1))) {
        input = input.slice(0, -1)
        telaResultado.innerHTML = telaResultado.innerHTML.slice(0, -1)
      }
      else {
        input = input.slice(0, -2)
        telaResultado.innerHTML = telaResultado.innerHTML.slice(0, -2)
      }
    }

    // FUNÇAO MODAL
    function salvar() {
      for(let i = 0; i < dadosHistorico.length; i++){
      modal.innerHTML += `${dadosHistorico[i]} <br>`
      }
    }

  </script>
</body>

</html>